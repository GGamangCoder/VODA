# 포팅 매뉴얼

## 개발환경

**FrontEnd**  

- npm: `9.8.0`
- Node.js: `18.16.1`
- React: `16.13.0`
- Redux: `4.2.1`
- styled-components: `6.0.5`  


**DevOps**  

- Docker: `23.0.1`
- Jenkins: `2.387.1`
- Nginx: `nginx/1.18.0`  

**Server**  

- AWS EC2: `ubuntu 20.04`
- IntelliJ: `IDEA 2022.3.1`
- SpringBoot: `2.7.9`
- JDK: `OpenJDK 11.0.17`

- tensorflow/tfjs-core: `4.10.0`
- face-api.js: `0.22.2`

- flask: `2.3.2`
- flask-cors: `4.0.0`
- opencv-python: `4.8.x`  


**Database**  

- MySQL: `8.0.32`  


**관리**  

- GitLab
- Jira
- Notion  


## 프로젝트 빌드 및 배포
1. 패키지 업데이트 진행
    
    ```bash
    sudo apt-get update
    ```
    
2. 필요 패키지 설치
    
    ```bash
    sudo apt-get install \
    		ca-certificates \
    		curl \
    		gnupg \
    		lsb-release
    ```
    
3. 도커의 Official GPG Key를 등록
    
    ```bash
    sudo mkdir -p /etc/apt/keyrings
    
    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
    ```
    
4. stable repository 등록
    
    ```bash
    echo \
    		"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
      $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
    ```
    
5. 도커와 도커 컴포즈 설치
    
    ```bash
    # 도커 설치
    sudo apt-get update
    sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin
    
    # 도커 컴포즈 설치
    sudo apt install docker-compose
    ```
    
6. 도커와 도커 컴포즈 확인
    
    ```bash
    # 도커 설치 확인
    sudo docker -v
    
    # 도커 컴포즈 설치 확인
    sudo docker-compose -v  


### Nginx & SSL 설정
1. Nginx 설정
    
    ```bash
    sudo apt-get install nginx
    ```
    
2. 설치 확인
    
    ```bash
    sudo nginx -v
    ```
    
3. Nginx 중지
    
    ```bash
    sudo systemctl stop nginx
    ```
    
4. Let’s Encrypt 설치
    
    ```bash
    sudo apt-get install letsencrypt
    ```
    
5. 인증서 적용 및 .pem 키
    
    ```bash
    sudo letsencrypt certonly --standalone -d [도메인]
    ```
    
6. 발급 경로 확인
    
    ```bash
    cd /etc/letsencrypt/live/[도메인]
    ```
    
7. 이동 후 conf 파일 생성
    
    ```bash
    cd /etc/nginx/sites-available
    sudo vim choom.conf
    ```
    
    ```bash
    # choom.conf
    server {
            location / {
                    proxy_pass http://localhost:3000;
            }
    
            location /api {
                    proxy_pass http://localhost:8081/api;
            }
    
      listen 443 ssl;
      server_name j8a501.p.ssafy.io;
    
      client_max_body_size 100M;
    
      # ssl 인증서 적용하기
      ssl_certificate /etc/letsencrypt/live/j8a501.p.ssafy.io/fullchain.pem;
      ssl_certificate_key /etc/letsencrypt/live/j8a501.p.ssafy.io/privkey.pem;
    
    }
    server {
        if ($host = j8a501.p.ssafy.io) {
            return 301 https://$host$request_uri;
        } # managed by Certbot
    
        listen 80;
        server_name j8a501.p.ssafy.io;
          return 404; # managed by Certbot
    }
    ```
    
8. 파일 연동 및 테스트
    
    ```bash
    sudo ln -s /etc/nginx/sites-available/test.conf /etc/nginx/sites-enabled/choom.conf
    sudo nginx -t
    ```
    
9. Nginx 재시작
    
    ```bash
    sudo systemctl restart nginx
    ```
    
10. Nginx 상태 확인
    
    ```bash
    sudo systemctl status nginx
    ```
